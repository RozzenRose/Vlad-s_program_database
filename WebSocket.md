#WebSocket

**Веб сокеты**(**WebSocket**) - это компьютерный коммуникационный протокол, предоставляющий полный дуплексный канал связи между клиентом и сервером через единственно **TCP** - соединение. В отличие от традиционного **HTTP**, который использует запросы-ответы, веб-сокеты позволяют клиенту и серверу обмениваться данными в реальном времени без необходимости инициализации нового соединения для каждого обмена информацией.

**Ключевые особенности веб-сокетов**:
- **Полный дуплекс**: данные могут передаваться одновременно в обоих направлениях  без задержки. В отличие от **HTTP**,  где клиент отправляет запрос, а сервер отправляет ответ после обработки.
- **Персистентное соединение**: Веб-сокет устанавливает долгоживущее соединение между клиентом и сервером. Это позволяет передавать данные без постоянного установления новых соединений, что повышает эффективность.
- **Низкая задержка**: Благодаря персистентному соединению и возможности двусторонней передачи данных, веб-сокеты обеспечивают очень низкую задержку в обмене данными.
- **Использование TCP**: Веб-сокеты строятся на верх **TCP**-соединения, что обеспечивает надежную доставку данных.

Обмен данными через **WebSocket** отличается от **HTTP** принципиально. **HTTP** использует модель **request-response** (запрос-ответ), где каждое взаимодействие требует нового соединения. **WebSocket** же устанавливает постоянное, двунаправленное соединение между клиентом и сервером, позволяя им обмениваться данными в реальном времени.

Вот как происходит обмен данными через **WebSocket**:

**1. Handshake (взаимное согласование):**
- **Клиент инициирует соединение:** Клиент (обычно веб-браузер или другое приложение) инициирует соединение с сервером, используя протокол WebSocket. Это делается с помощью HTTP-запроса на upgrade до WebSocket. Этот запрос содержит заголовок `Upgrade: websocket`.
- **Сервер принимает или отклоняет запрос:** Сервер проверяет запрос и, если все в порядке (поддерживаемый протокол, правильные заголовки), отвечает сообщением подтверждения (`101 Switching Protocols`), тем самым подтверждая установление WebSocket-соединения.
- **Установление соединения:** После успешного handshake устанавливается постоянное TCP-соединение.

 **2. Обмен данными (Data Exchange)**:
 - **Двунаправленный обмен:** После установления соединения, клиент и сервер могут отправлять данные друг другу в любое время, без необходимости отправлять новые HTTP-запросы. Это “полный дуплекс”.
- **Фреймы (Frames):** Данные передаются в виде фреймов — маленьких пакетов данных. Каждый фрейм содержит заголовок и тело (данные). Заголовок содержит информацию о типе фрейма, маске (для шифрования), длине тела и т.д.
- **Текстовые и бинарные данные:** WebSocket поддерживает как текстовые, так и бинарные данные.
- **Протокол:** Сам обмен данными происходит по протоколу WebSocket, который определяет формат фреймов и способы обработки данных.

**3. Закрытие соединения:**
- **Завершение соединения:** Когда клиент или сервер хотят закрыть соединение, они отправляют специальный фрейм с кодом закрытия.
- **Уведомление:** Другая сторона получает уведомление о закрытии соединения.

**В кратце:**
1. **Handshake (HTTP Upgrade):** Переход от HTTP к WebSocket.
2. **Постоянное соединение:** Установление долгоживущего TCP-соединения.
3. **Обмен фреймами:** Передача данных в виде маленьких пакетов.
4. **Двунаправленный поток:** Одновременная передача данных от клиента к серверу и обратно.
5. **Закрытие соединения:** Упорядоченное завершение соединения.

Представьте чат. Клиент подключается к серверу через **WebSocket**. Когда пользователь печатает сообщение,  клиент отправляет его на сервер через **WebSocket**. Сервер обрабатывает сообщение и рассылает его другим клиентам, подключенным к тому же чату, также через **WebSocket**. Все это происходит без необходимости отправлять новые **HTTP**-запросы для каждого сообщения
![[Pasted image 20250428163001.png]]
**WebSocket** обеспечивает значительно более эффективный и быстрый обмен данными в реальном времени по сравнению с **HTTP**, особенно для приложений, где требуются постоянное взаимодействие между клиентом и сервером.
#база_данных #реляционные #SQL #СУБД #подзапросы 

При сравнении некоторого значения с результатом подзапроса требуется, чтобы этим результатом была таблица из одного поля и одной записи или из одного поля и нескольких записей. Однако SQL позволяет сравнивать не только одиночные значения, но и пары значений. В подобных случаях используются подзапросы, возвращающие таблицы из нескольких полей.

В качестве примера использования такого подзапроса напишем запрос, извлекающий данные о книгах, которые имеют минимальный рейтинг и от критиков, и от пользователей.
```sql
SELECT title, critic_score, user_score
FROM Books
WHERE (critic_score, user_score) = (SELECT MIN(critic_score), MIN(user_score)
                                    FROM Books);
```
```no-highlight
+-----------------------+--------------+------------+
| title                 | critic_score | user_score |
+-----------------------+--------------+------------+
| The Shining           | 39           | 51         |
| The Lord of the Rings | 39           | 51         |
+-----------------------+--------------+------------+
```

Подзапрос в данном запросе возвращает таблицу из двух полей, первое из которых содержит минимальное значение поля `critic_score`, второе — минимальное значение поля `user_score`:
```no-highlight
+-------------------+-----------------+
| MIN(critic_score) | MIN(user_score) |
+-------------------+-----------------+
| 39                | 51              |
+-------------------+-----------------+
```

Затем основной запрос выполняет фильтрацию путем парного сравнения значений записи с полученными подзапросом минимальными значениями. Запись попадает в результирующую таблицу, если ее значение поля `critic_score` равняется минимальному значению этого же поля (`39`) и если ее значение поля `user_score` равняется минимальному значению этого же поля (`51`).

Фактически запрос выше эквивалентен следующему запросу:
```sql
SELECT title, critic_score, user_score
FROM Books
WHERE critic_score = 39 AND user_score = 51;
```

Если с результатом подзапроса сравнивается не одно поле, а несколько, эти поля должны быть заключены в скобки
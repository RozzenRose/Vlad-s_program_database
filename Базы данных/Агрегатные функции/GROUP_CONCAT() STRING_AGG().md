#база_данных #реляционные #SQL #СУБД #агрегатные_функции #GROUP_CONCAT #STRING_AGG

---
Функция `GROUP_CONCAT()` используется для перечисления значений поля через запятую. Например, с помощью данной функции мы можем перечислить названия первых пяти песен.
```
+----+-------+-------------------------+------------+---------+--------------+--------+
| id | place | trackname               | artist     | streams | release_year | length |
+----+-------+-------------------------+------------+---------+--------------+--------+
| 1  | 4     | Crazy on You            | Heart      | 303885  | 1976         | 254    |
| 2  | 7     | My Lover                | The Sounds | 211133  | 2009         | 266    |
| 3  | 3     | Running up That Hill    | Kate Bush  | 339583  | NULL         | 296    |
| 4  | 5     | Thrill                  | The Sounds | 294264  | 2016         | 228    |
| 5  | 9     | Spent the Day in Bed    | Morrissey  | 174994  | 2017         | 259    |
| 6  | 2     | Bigmouth Strikes Again  | The Smiths | 379112  | 1986         | 195    |
| 7  | 6     | Painted By Numbers      | The Sounds | 265121  | 2006         | 200    |
| 8  | 8     | Let Me Kiss You         | Morrissey  | 197426  | 2004         | 210    |
| 9  | 1     | Keep Yourself Alive     | Queen      | 385991  | NULL         | 235    |
| 10 | 10    | Everyday is Like Sunday | Morrissey  | 160404  | 1988         | 216    |
+----+-------+-------------------------+------------+---------+--------------+--------+
```

```SQL
SELECT GROUP_CONCAT(trackname) AS songs
FROM Songs
WHERE id <= 5;
```
```
+------------------------------------------------------------------------+
| songs                                                                  |
+------------------------------------------------------------------------+
| Crazy on You,My Lover,Running up That Hill,Thrill,Spent the Day in Bed |
+------------------------------------------------------------------------+
```
Перечисляемые функцией `GROUP_CONCAT()` значения можно сортировать. Для этого после названия поля, значения которого необходимо перечислить, нужно указать оператор `ORDER BY`, а затем предоставить одно или несколько полей, по которым должна быть выполнена сортировка.
```SQL
SELECT GROUP_CONCAT(trackname ORDER BY trackname) AS songs
FROM Songs
WHERE id <= 5;
```
```
+------------------------------------------------------------------------+
| songs                                                                  |
+------------------------------------------------------------------------+
| Crazy on You,My Lover,Running up That Hill,Spent the Day in Bed,Thrill |
+------------------------------------------------------------------------+
```

Запятая является разделителем по умолчанию, и его можно изменить. Чтобы задать собственный разделитель, необходимо воспользоваться ключевым словом `SEPARATOR`, после которого предоставить строку, содержащую разделитель.
```sql
SELECT GROUP_CONCAT(trackname SEPARATOR '; ') AS songs
FROM Songs
WHERE id <= 5;
```
```
+----------------------------------------------------------------------------+
| songs                                                                      |
+----------------------------------------------------------------------------+
| Crazy on You; My Lover; Running up That Hill; Thrill; Spent the Day in Bed |
+----------------------------------------------------------------------------+
```

При совместном использовании операторов `ORDER BY` и `SEPARATOR` внутри функции `GROUP_CONCAT()` важно соблюдать их расположение относительно друг друга: сначала указываются правила сортировки, после определяется разделитель.
```SQL
SELECT GROUP_CONCAT(trackname ORDER BY trackname SEPARATOR '; ') AS songs
FROM Songs
WHERE id <= 5;
```
```
+----------------------------------------------------------------------------+
| songs                                                                      |
+----------------------------------------------------------------------------+
| Crazy on You; My Lover; Running up That Hill; Spent the Day in Bed; Thrill |
+----------------------------------------------------------------------------+
```

### В `PostgreSQL` нет этой функции, но есть функция `STRING_AGG`
```PostgreSQL
SELECT STRING_AGG(column_name, ', ') AS concatenated_values
FROM your_table;
```
В качестве второго аргумента указывается разделитель в строке результата, можно не вызывать `SEPARATOR`
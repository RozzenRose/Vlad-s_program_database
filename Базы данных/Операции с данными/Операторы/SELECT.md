#база_данных #реляционные #SQL #СУБД #SELECT

Задачи, которые обычно приходится выполнять с базой данных, чаще всего сводятся к извлечению из нее необходимой информации. Это может быть получение конкретной записи, находящийся в одной из таблиц, или нескольких записей, удовлетворяющих определенным условиям. За все подобные задачи, связанные с извлечением данных, отвечает всего один оператор - `SELECT`

Таблица для примеров:
```
+----+-------+----------------------+------------+---------+
| id | place | trackname            | artist     | streams |
+----+-------+----------------------+------------+---------+
| 1  | 4     | Crazy On You         | Heart      | 76338   |
| 2  | 3     | My Lover             | The Sounds | 99488   |
| 3  | 2     | Running up That Hill | Kate Bush  | 121495  |
| 4  | 5     | Thrill               | The Sounds | 49345   |
| 5  | 1     | Spent the Day in Bed | Morrissey  | 174994  |
+----+-------+----------------------+------------+---------+
```
##### Скрипт создания таблицы для примера:
```MySQL
DROP TABLE IF EXISTS Songs;
CREATE TABLE Songs
(
    id        INT PRIMARY KEY AUTO_INCREMENT,
    place     INT,
    trackname VARCHAR(30),
    artist    VARCHAR(30),
    streams   INT
);

INSERT INTO Songs (place, trackname, artist, streams)
VALUES (4, 'Crazy On You', 'Heart', 76338),
       (3, 'My Lover', 'The Sounds', 99488),
       (2, 'Running up That Hill', 'Kate Bush', 121495),
       (5, 'Thrill', 'The Sounds', 49345),
       (1, 'Spent the Day in Bed', 'Morrissey', 174994);
```
```PostgreSQL
DROP TABLE IF EXISTS "Songs";
CREATE TABLE "Songs"
(
    id        SERIAL PRIMARY KEY,
    place     INT,
    trackname VARCHAR(30),
    artist    VARCHAR(30),
    streams   INT
);

INSERT INTO "Songs" (place, trackname, artist, streams)
VALUES (4, 'Crazy On You', 'Heart', 76338),
       (3, 'My Lover', 'The Sounds', 99488),
       (2, 'Running up That Hill', 'Kate Bush', 121495),
       (5, 'Thrill', 'The Sounds', 49345),
       (1, 'Spent the Day in Bed', 'Morrissey', 174994);
```
### Извлечение полей
Чтобы при помощи оператора `SELECT` извлечь данные из базы, нужно указать как минимум две вещи: что именно нужно извлечь и откуда. Начнем с простейшего запроса, который извлекает одно определенное поле таблицы.
```sql
SELECT trackname
FROM Songs;
```
```
+----------------------+
| trackname            |
+----------------------+
| Crazy on You         |
| My Lover             |
| Running up That Hill |
| Thrill               |
| Spent the Day in Bed |
+----------------------+
```
Здесь оператор `SELECT` извлекает одно поле под названием `trackname` из таблицы `Songs`. Имя поля указывается сразу после ключевого слова `SELECT`, а ключевое слово `FROM` указывает на таблице, из которой извлекаются данные. Также следует отметить, что этот запрос извлекает все записи таблицы, не выполняя никакой фильтрации

Операторы нечувствительны к регистру, поэтому, например, записи  `SELECT, select` и `Select` эквивалентны. Чаще всего разработчики применяют верхний регистр для операторов и нижний регистр для имен полей.

Для извлечения нескольких полей таблицы после оператора `SELECT` необходимо через запятую перечислить их имена.
```sql
SELECT trackname, artist, streams
FROM Songs;
```
```
+----------------------+------------+---------+
| trackname            | artist     | streams |
+----------------------+------------+---------+
| Crazy on You         | Heart      | 76338   |
| My Lover             | The Sounds | 99488   |
| Running up That Hill | Kate Bush  | 121495  |
| Thrill               | The Sounds | 49345   |
| Spent the Day in Bed | Morrissey  | 174994  |
+----------------------+------------+---------+
```
Следует заметить, что поля возвращаются именно в том порядке, в котором они указываются в самом запросе.
```sql
SELECT streams, artist, trackname
FROM Songs;
```
```
+---------+------------+----------------------+
| streams | artist     | trackname            |
+---------+------------+----------------------+
| 76338   | Heart      | Crazy on You         |
| 99488   | The Sounds | My Lover             |
| 121495  | Kate Bush  | Running up That Hill |
| 49345   | The Sounds | Thrill               |
| 174994  | Morrissey  | Spent the Day in Bed |
+---------+------------+----------------------+
```
Помимо извлечения конкретных полей, с помощью оператора `SELCT` можно запросить все поля, не указывая каждое из них. Для этого вместо имен следует указать специальный групповой символ `*`
```sql
SELECT *
FROM Songs;
```
```
+----+----------+----------------------+------------+---------+
| id | place    | trackname            | artist     | streams |
+----+----------+----------------------+------------+---------+
| 1  | 4        | Crazy on You         | Heart      | 76338   |
| 2  | 3        | My Lover             | The Sounds | 99488   |
| 3  | 2        | Running up That Hill | Kate Bush  | 121495  |
| 4  | 5        | Thrill               | The Sounds | 49345   |
| 5  | 1        | Spent the Day in Bed | Morrissey  | 174994  |
+----+----------+----------------------+------------+---------+
```
Несмотря на то что групповой символ помогает сэкономить время, необходимое для перечисления всех нужных полей, используется он не так часто, так как извлечение ненужных полей обычно приводит к снижению производительности запроса. Однако есть одно преимущество в использовании группового символа: поскольку нет необходимости указывать точные имена полей, появляется возможность извлечь поля, имена которых неизвестны.
### Извлечение уникальных записей
Чтобы извлечь только уникальные записи, необходимо воспользоваться ключевым словом `DISTINCT`, которое указывается непосредственно перед именами полей.
```sql
SELECT DISTINCT artist
FROM Songs;
```
```
+------------+
| artist     |
+------------+
| Heart      |
| The Sounds |
| Kate Bush  |
| Morrissey  |
+------------+
```
Важно отметить, что ключевое слово `DISTINCT` применяется ко всем полям, а не только к тому, перед которым оно стоит, поэтому при его использовании для двух и более полей одинаковыми будут считаться лишь те записи, которые имеют одинаковые значения по всем полям.
```sql
SELECT DISTINCT trackname, artist
FROM Songs;
```
```
+----------------------+------------+
| trackname            | artist     |
+----------------------+------------+
| Crazy on You         | Heart      |
| My Lover             | The Sounds |
| Running up That Hill | Kate Bush  |
| Thrill               | The Sounds |
| Spent the Day in Bed | Morrissey  |
+----------------------+------------+
```
Здесь вторая и четвертая записи считаются разными, так как их значения совпадают не по всем полям, а только по одному.
### Ограничения результатов запроса
Иногда при извлечении данных из таблицы может потребоваться получить лишь первую запись или некоторое определенное количество записей. Сделать это можно с помощью ключевого слова `LIMIT`.
```sql
SELECT trackname
FROM Songs
LIMIT 3;
```
```
+----------------------+
| trackname            |
+----------------------+
| Crazy on You         |
| My Lover             |
| Running up That Hill |
+----------------------+
```
Запрос выше извлекает поле `trackname`, а выражение `LIMIT 3` говорит о том, что должно быть извлечено не более трех записей. Если необходимо получить следующие три записи, можно задать начальную точку извлечения с помощью ключевого слова `OFFSET`.
```sql
SELECT trackname
FROM Songs
LIMIT 3
OFFSET 2;
```
```
+----------------------+
| trackname            |
+----------------------+
| Running up That Hill |
| Thrill               |
| Spent the Day in Bed |
+----------------------+
```
Выражение `LIMIT 3 OFFSET 2` говорит о том, что должно быть извлечено три записи, начиная с записи с индексом два. Таким образом, первое число — это количество строк для извлечения, а второе — начальная точка.

Записи при использовании ключевого слова `OFFSET` индексируются с нуля, поэтому, например, выражение `LIMIT 1 OFFSET 1` вернет вторую запись, а не первую.

Следует понимать, что ключевое слово `LIMIT` лишь ограничивает количество извлекаемых записей, а не определяет их количество. Например, если в таблице содержится пять записей, а ограничивающим значением является число десять, то извлечены будут все пять записей и только они.
```sql
SELECT trackname
FROM Songs
LIMIT 10;
```
```
+----------------------+
| trackname            |
+----------------------+
| Crazy on You         |
| My Lover             |
| Running up That Hill |
| Thrill               |
| Spent the Day in Bed |
+----------------------+
```
Ключевое слово `OFFSET` можно использовать только в паре с ключевым словом `LIMIT`.
### Псевдонимы
При извлечении различных полей таблицы они сохраняют свои исходные имена в результирующей таблице, однако при необходимости можно воспользоваться **псевдонимами**, чтобы дать им альтернативные имена. Делается это с помощью ключевого слова `AS`, которое располагается между исходным именем поля и новым
```sql
SELECT trackname AS 'Song name',
       artist AS Artist
FROM Songs;
```
```
+----------------------+------------+
| Song name            | Artist     |
+----------------------+------------+
| Crazy On You         | Heart      |
| My Lover             | The Sounds |
| Running up That Hill | Kate Bush  |
| Thrill               | The Sounds |
| Spent the Day in Bed | Morrissey  |
+----------------------+------------+
```
Обратите внимание: если псевдоним состоит из нескольких слов, он должен быть представлен строкой, заключенной в апострофы, но только если это БД `MySQL`, в случае, если это `PostgreSQL`, используются двойные кавычки `"Song name"`.

Псевдонимы могут содержать до `255` знаков, включая пробелы, цифры и специальные символы

### Примечания
**Примечание 1.** Записи в результирующей таблице иногда могут отображаться в произвольном порядке, и это нормально. Например, это может быть порядок, в котором записи заносились в таблицу. Главное, чтобы запрос возвращал одни и те же записи.

**Примечание 2.** Все лишние пробельные символы в запросе пропускаются при его обработке, поэтому запрос может быть записан как в одной длинной строке, так и разбит на несколько строк.

Например, приведенные ниже запросы функционально полностью идентичны:
```sql
SELECT trackname
FROM Songs;
```
   
```sql
SELECT trackname FROM Songs;
```

```sql
SELECT
trackname
FROM
Songs;
```

**Примечание 3.** Оператор `SELECT` может использоваться не только для извлечения данных из базы, но и для вывода конкретных значений, например, строк или чисел.
```sql
SELECT 'beegeek';
```
```
+---------+
| beegeek |
+---------+
| beegeek |
+---------+
```

```sql
SELECT 100, 200, 300;
```
```
+-----+-----+-----+
| 100 | 200 | 300 |
+-----+-----+-----+
| 100 | 200 | 300 |
+-----+-----+-----+
```

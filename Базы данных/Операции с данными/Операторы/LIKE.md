#база_данных #реляционные #SQL #СУБД #LIKE #ILIKE


``` Таблица для примеров
+----+-------+--------------------------------------+---------------+
| id | place | trackname                            | artist        |
+----+-------+--------------------------------------+---------------+
| 1  | 4     | You Just Haven't Earned It Yet, Baby | The Smiths    |
| 2  | 3     | Crazy On You                         | Heart         |
| 3  | 2     | Dark Days                            | Theredsunband |
| 4  | 5     | Wish You Were Here                   | The Sounds    |
| 5  | 1     | Let Me Kiss You                      | Morrissey     |
+----+-------+--------------------------------------+---------------+
```
Метасимволы - это инструмент создания шаблонов поиска. 

Метасимволы сами по себе являются специальными знаками, которые трактуются языком особым образом. Чтобы использовать их в условиях отбора записей, необходимо задействовать оператор `LIKE`, который говорит о том, что следующий шаблон поиска необходимо анализировать с учетом метасимволов, а не искать точные совпадения

Шаблоны поиска представляют собой строки, состоящие из обычных символов, метасимволов или любой из комбинации, поэтому поиск с использованием метасимволов может осуществляться только в строковых полях

для отрицания шаблона можно примять `NOT LIKE`
#### Метасимвол `%`
Наиболее часто используемым метасимволом является знак процента `%`, который в шаблоне поиска соответствует последовательности любых символов, причем число символов в последовательности может быть от `0` и более. Например, чтобы найти информацию о песнях, названия исполнителей которых начинаются с последовательности символов `The`, можно составить следующий шаблон поиска: `The%`
```MySQL
SELECT trackname, artist
FROM Songs
WHERE artist LIKE 'The%';
```
```
+--------------------------------------+---------------+
| trackname                            | artist        |
+--------------------------------------+---------------+
| You Just Haven't Earned It Yet, Baby | The Smiths    |
| Dark Days                            | Theredsunband |
| Wish You Were Here                   | The Sounds    |
+--------------------------------------+---------------+
```
#### Метасимвол `_`
Еще одним полезным метасимволом является знак нижнего подчеркивания `_`, который в шаблоне поиска соответствует одному любому символу. Например, с его помощью можно составить запрос, который поможет отыскать информацию о песнях, названия которых начинаются с какого-либо четырехсимвольного слова
```MySQL
SELECT trackname, artist
FROM Songs
WHERE trackname LIKE '____ %';
```
```
+--------------------+---------------+
| trackname          | artist        |
+--------------------+---------------+
| Dark Days          | Theredsunband |
| Wish You Were Here | The Sounds    |
+--------------------+---------------+
```
### Регистрозависимость
Важной особенностью оператора `LIKE` является то, что при поиске с его помощью строк, соответствующих шаблону, не учитывается регистр символов, используемых в этом шаблоне. Например, один из рассмотренных нами шаблонов поиска `%You%` мы могли записать в виде `%you%` или `%YOU%`, и результат остался бы прежним.
```MySQL
SELECT trackname, artist
FROM Songs
WHERE trackname LIKE '%you%';
```
```
+--------------------------------------+------------+
| trackname                            | artist     |
+--------------------------------------+------------+
| You Just Haven't Earned It Yet, Baby | The Smiths |
| Crazy On You                         | Heart      |
| Wish You Were Here                   | The Sounds |
| Let Me Kiss You                      | Morrissey  |
+--------------------------------------+------------+
```

Безусловно, такое поведение удобно, однако не всегда нужно. Поэтому в случаях, когда регистр символов важен, шаблон поиска необходимо преобразовать в тип данных `BINARY` с помощью функций `CAST()` или `CONVERT()`.

Результатом приведенного ниже запроса:
```MySQL
SELECT trackname, artist
FROM Songs
WHERE trackname LIKE CAST('%You%' AS BINARY);
```
как и результатом приведенного ниже запроса:
```MySQL
SELECT trackname, artist
FROM Songs
WHERE trackname LIKE CONVERT('%You%', BINARY);
```
```
+--------------------------------------+------------+
| trackname                            | artist     |
+--------------------------------------+------------+
| You Just Haven't Earned It Yet, Baby | The Smiths |
| Crazy On You                         | Heart      |
| Wish You Were Here                   | The Sounds |
| Let Me Kiss You                      | Morrissey  |
+--------------------------------------+------------+
```

При этом результат приведенного ниже запроса:
```MySQL
SELECT trackname, artist
FROM Songs
WHERE trackname LIKE CAST('%you%' AS BINARY);
```
как и результат приведенного ниже запроса, пуст:
```MySQL
SELECT trackname, artist
FROM Songs
WHERE trackname LIKE CONVERT('%you%', BINARY);
```

В `PostgreSQL` есть регистрозависимость при использовании оператора `LIKE`, в случае, когда нужно отменить регистрозависимость при поиске применяется оператор `ILIKE`, которые делает то же самое, что `LIKE`, но не учитывает регистр
### Примечания

**Примечание 1.** Метасимволы — очень мощный механизм. Но за эту мощь приходится платить, так как на поиск с использованием метасимволов уходит больше времени, чем на любые другие виды поиска. Поэтому если можно использовать другой оператор поиска, то следует задействовать именно его.

**Примечание 2.** Метасимволы в шаблоне поиска соответствуют набору символов или одному любому символу, однако иногда может понадобиться отыскать совпадение только для самого метасимвола, например, символа процента (`%`). В подобных случаях используется экранирование с помощью ключевого слова `ESCAPE`, которое указывается после шаблона поиска и определяет символ, отвечающий за экранирование.

Например, условие для поиска значений вида `10%, 24%, 49%` и так далее может выглядеть следующим образом:

```sql
...
WHERE <название поля> LIKE '__/%' ESCAPE '/';
```

Здесь для экранирования используется прямой слеш (`/`), который в шаблоне указывает на то, что символ, стоящий после прямого слеша, не следует рассматривать как метасимвол. 

**Примечание 3.** Метасимвол `%` может соответствовать чему угодно, но есть одно исключение: `NULL`. Никакой шаблон поиска не позволит отобрать запись, проверяемое поле которой содержит значение `NULL`.

**Примечание 4.** При составлении шаблона поиска, с помощью которого планируется выполнять поиск строк типа `CHAR`, необходимо помнить, что этот тип данных заполняет пробелами неиспользуемую часть строки. Если не учитывать в шаблоне потенциальные пробелы, поиск может выполняться неверно.
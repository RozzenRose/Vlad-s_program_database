#база_данных #реляционные #SQL #СУБД 

Выбор определенного значения в зависимости от истинности некоторого условия является нередкой задачей, для решения которой достаточно воспользоваться функцией `IF()`, если условие для проверки всего одно, или же оператором `CASE`, если таких условий несколько. Однако если задача требует не просто выбрать значение, а выполнить какую-либо операцию, то ни функция `IF()`, ни оператор `CASE` решить ее не помогут.

При необходимости проверить одно или несколько условий и в зависимости от истинности одного из них выполнить ряд операций, скажем, присваивать значение переменной, используется условная конструкция `IF-ELSEIF-ELSE`. Синтаксис данной конструкции достаточно близок к синтаксису оператора `CASE` и по большому счету отличается лишь тем, что вместо возвращаемых значений в нем указываются целый операции.

Итак, синтаксис условной конструкции `IF-ELSEIF-ELSE` выглядит следующим образом:
```sql
IF <первое проверяемое условие> THEN
    <одна или несколько операций>;
ELSEIF <второе проверяемое условие> THEN
    <одна или несколько операций>;
ELSEIF <третье проверяемое условие> THEN
    <одна или несколько операций>;
...
ELSEIF <n-ое проверяемое условие> THEN
    <одна или несколько операций>;
ELSE <одна или несколько операций>;
END IF;
```
Конструкция начинается с ключевого слова `IF`, после которого указывается первое проверяемое условие. Следом располагается ключевое слово `THEN`, а затем одна или несколько операций, которые должны быть выполнены, если условие окажется истинным.

После блока с первым условием следуют блоки со вторым, третьим и всеми последующими условиями. Блок с каждым дополнительным условием начинается с ключевого слова `ELSEIF`, после которого указывается само условие. Следом за условием располагается все то же ключевое слово `THEN`, а затем одна или несколько операций, которые должны быть выполнены, если условие окажется истинным.

После блока с последним дополнительным условием указывается ключевое `ELSE`, а затем одна или несколько операций, которые должны быть выполнены, если ни одно рассмотренное условие не окажется истинным. Завершается условная конструкция парой ключевых слов `END IF`.

Блоки `ELSEIF`, а также блок `ELSE` являются необязательными и при необходимости могут быть опущены.
### Примеры использования конструкции IF-ELSEIF-ELSE
**Пример 1**. Создадим пользовательскую функцию `IS_EVEN()` для определения того, является ли число четным. Функция будет принимать в качестве аргумента целое число и возвращать значение `1`, если оно является четным, или `0` в противном случае.
```sql
DELIMITER //
CREATE FUNCTION IS_EVEN(number INT)
RETURNS INT
DETERMINISTIC
BEGIN
    DECLARE result INT;
    
    IF number MOD 2 = 0 THEN
        SET result := 1;
    ELSE
        SET result := 0;
    END IF;
    
    RETURN result;
END //
DELIMITER ;

SELECT IS_EVEN(10),
       IS_EVEN(15);
```
```
+-------------+-------------+
| IS_EVEN(10) | IS_EVEN(15) |
+-------------+-------------+
| 1           | 0           |
+-------------+-------------+
```
В примере выше вновь предлагается функция `IS_EVEN()`, рассмотренная в прошлом уроке, однако в данном случае ее тело реализуется не с помощью функции `IF()`, а с помощью условной конструкции `IF-ELSEIF-ELSE`. Тело функции начинается с создания переменной `result`, которая используется для хранения результата работы функции. Значение переменной определяется с помощью условной конструкции: если число, переданной в функцию, является четным, условная конструкция присваивает переменной `result` значение `1`, в противном случае переменная принимает значение `0`. Завершается тело функции возвратом значения переменной `result`

Условная конструкция `IF-ELSEIF-ELSE` внутри функции `IS_EVEN()` включает блоки `IF` и `ELSE`, однако несложно понять, что от блока `ELSE` можно избавиться, если сразу определить переменную `result` со значением `0`
```sql
DELIMITER //
CREATE FUNCTION IS_EVEN(number INT)
RETURNS INT
DETERMINISTIC
BEGIN
    DECLARE result INT DEFAULT 0;
    
    IF number MOD 2 = 0 THEN
        SET result := 1;
    END IF;
    
    RETURN result;
END //
DELIMITER ;

SELECT IS_EVEN(10),
       IS_EVEN(15);
```
```
+-------------+-------------+
| IS_EVEN(10) | IS_EVEN(15) |
+-------------+-------------+
| 1           | 0           |
+-------------+-------------+
```
Здесь переменная `result` после создания принимает значение `0`. если число, переданной в функцию `IS_EVEN()`, это позволяет нам обойтись без использования переменной `result` и сразу выполнять возврат значения `1`, если переданной в функцию число является четным, или `0` в противном случае.
```sql
DELIMITER //
CREATE FUNCTION IS_EVEN(number INT)
RETURNS INT
DETERMINISTIC
BEGIN
    IF number MOD 2 = 0 THEN
        RETURN 1;
    END IF;
    
    RETURN 0;
END //
DELIMITER ;

SELECT IS_EVEN(10),
       IS_EVEN(15);
```
```
+-------------+-------------+
| IS_EVEN(10) | IS_EVEN(15) |
+-------------+-------------+
| 1           | 0           |
+-------------+-------------+
```
Обратите внимание, что тело функции может включать несколько операторов `RETURN`, однако нужно понимать, что после выполнения одного из них функция выполнит возврат значения и завершит работу, проигнорировав оставшиеся внутри тела операции.

**Пример 2**. Создадим пользовательскую функцию `ANALYSE()` для анализа числа. Функция будет принимать в качестве аргумента целое число и возвращать строку `Positive`, если оно является положительным, `Negative`, если отрицательным, и `Zero`, если число является нулем.
```sql
DELIMITER //
CREATE FUNCTION ANALYSE(number INT)
RETURNS TEXT
DETERMINISTIC
BEGIN
    IF number > 0 THEN
        RETURN 'Positive';
    ELSEIF number < 0 THEN
        RETURN 'Negative';
    ELSE
        RETURN 'Zero';
    END IF;
END //
DELIMITER ;

SELECT ANALYSE(5),
       ANALYSE(-10),
       ANALYSE(0);
```
```
+------------+--------------+------------+
| ANALYSE(5) | ANALYSE(-10) | ANALYSE(0) |
+------------+--------------+------------+
| Positive   | Negative     | Zero       |
+------------+--------------+------------+
```
Пример выше демонстрирует полноценную условную конструкцию `IF-ELSEIF-ELSE` с блоками `IF`, `ELSEIF` и `ELSE`. если переданной в функцию число является положительным, выполняется первое условие и функция возвращает строковое значение `Positive`. если число является отрицательным, истинным становится второе условие и функция возвращает строковое значение `Negative`. В случае ложности обоих условий возвращаемым значением функции становится строка `Zero`.
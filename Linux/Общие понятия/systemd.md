#Linux 
`systemd` — это система инициализации и менеджер служб для Linux, предназначенный для повышения производительности системы и управления процессами. Он заменяет старые системы инициализации, такие как SysVinit, и предоставляет множество функций для управления службами, контрольных точек и журналов. 

### Основные возможности `systemd`

1. **Быстрый запуск системы**:
   - Параллельный запуск служб и оптимизация процесса инициализации.
   
2. **Управление службами**:
   - Удобные команды для запуска, остановки, перезапуска и управления состоянием служб.
   
3. **Журналирование**:
   - Сбор и управление системными и служебными журналами.
   
4. **Управление устройствами и монтирование**:
   - Поддержка автоматического монтирования файловых систем и управление устройствами.

### Основные команды systemctl

`systemctl` — это основной инструмент для управления `systemd`. Вот несколько часто используемых команд:

1. **Запуск службы**:

```sh
sudo systemctl start имя_службы
```

2. **Остановка службы**:

```sh
sudo systemctl stop имя_службы
```

3. **Перезапуск службы**:

```sh
sudo systemctl restart имя_службы
```

4. **Проверка состояния службы**:

```sh
sudo systemctl status имя_службы
```

5. **Включение службы при загрузке системы**:

```sh
sudo systemctl enable имя_службы
```

6. **Отключение службы при загрузке системы**:

```sh
sudo systemctl disable имя_службы
```

7. **Перезагрузка доступных служб**

```sh
sudo systemctl daemon-reload
```

### Основные команды journalctl

`journalctl` — это инструмент для просмотра и анализа журналов, созданных `systemd`. Он позволяет фильтровать и искать события в системных и служебных журналах.

1. **Просмотр всех журналов**:

```sh
sudo journalctl
```

2. **Просмотр журналов с момента последней загрузки**:

```sh
sudo journalctl -b
```

3. **Просмотр журналов конкретной службы**:

```sh
sudo journalctl -u имя_службы
```

4. **Просмотр последних `N` строк журнала**:

```sh
sudo journalctl -n N
```

5. **Непрерывный просмотр журналов в реальном времени**:

```sh
sudo journalctl -f
```

6. **Фильтрация журналов по времени**:

```sh
sudo journalctl --since "2023-01-01 00:00:00" --until "2023-01-02 00:00:00"
```

### Примеры использования journalctl

#### Пример 1: Просмотр журналов службы Apache

```sh
sudo journalctl -u apache2
```

Этот вызов покажет все журналы, связанные с службой Apache.

#### Пример 2: Просмотр последних 100 строк журнала

```sh
sudo journalctl -n 100
```

Этот вызов покажет последние 100 строк журнала.

#### Пример 3: Непрерывный просмотр журналов в реальном времени

```sh
sudo journalctl -f
```

Этот вызов будет показывать новые строки журнала по мере их появления.

#### Пример 4: Просмотр журналов с момента последней загрузки системы

```sh
sudo journalctl -b
```

Этот вызов покажет все журналы с момента последней загрузки системы.

# Файлы служб

`.service` файлы в `systemd` — это файлы конфигурации, которые описывают, как управлять службами (процессами) в системе. Они определяют, как и когда должны запускаться службы, а также какие действия выполнять при их остановке, перезапуске или сбоях. `.service` файлы обычно находятся в каталогах `/etc/systemd/system/`, `/lib/systemd/system/` или `/usr/lib/systemd/system/` в зависимости от системы и пакета.

### Структура .service файла

Файл `.service` состоит из нескольких секций, каждая из которых содержит определённые параметры. Основные секции включают `[Unit]`, `[Service]` и `[Install]`.

#### Секция [Unit]

Эта секция содержит общие сведения о службе.

- **Description**: Краткое описание службы.
- **Documentation**: URL или путь к документации.
- **After**: Указывает на то, какие службы должны быть запущены до данной.
- **Before**: Указывает на то, какие службы должны быть запущены после данной.
- **Requires**: Определяет службы, которые должны быть запущены вместе с данной.
- **Wants**: Более слабая зависимость, чем `Requires`.

Пример:

```ini
[Unit]
Description=My Custom Service
After=network.target
```

#### Секция [Service]

Эта секция содержит параметры, определяющие, как должна работать сама служба.

- **Type**: Определяет тип службы (simple, forking, oneshot, dbus, notify, idle).
- **ExecStart**: Команда для запуска службы.
- **ExecStop**: Команда для остановки службы.
- **ExecReload**: Команда для перезагрузки службы.
- **Restart**: Политика перезапуска при сбое (always, on-failure, on-abnormal, on-abort, on-watchdog).
- **User**: Пользователь, от имени которого будет запущена служба.
- **Group**: Группа, от имени которой будет запущена служба.
- **WorkingDirectory**: Рабочий каталог для службы.

Пример:

```ini
[Service]
Type=simple
ExecStart=/usr/bin/my-service
Restart=on-failure
User=myuser
Group=mygroup
WorkingDirectory=/home/myuser
```

#### Секция [Install]

Эта секция содержит параметры, определяющие, как и когда служба должна быть установлена или включена.

- **WantedBy**: Определяет цели, для которых эта служба важна. Обычно это `multi-user.target` для большинства пользовательских служб.

Пример:

```ini
[Install]
WantedBy=multi-user.target
```

### Пример полного .service файла

Вот пример полного `.service` файла для пользовательской службы:

```ini
[Unit]
Description=My Custom Service
After=network.target

[Service]
Type=simple
ExecStart=/usr/bin/my-service
Restart=on-failure
User=myuser
Group=mygroup
WorkingDirectory=/home/myuser

[Install]
WantedBy=multi-user.target
```

### Управление .service файлами с помощью systemctl

После создания .service файла, необходимо выполнить несколько шагов для управления службой.

1. **Перезагрузка конфигурации systemd**:

```sh
sudo systemctl daemon-reload
```

2. **Запуск службы**:

```sh
sudo systemctl start my-service
```

3. **Остановка службы**:

```sh
sudo systemctl stop my-service
```

4. **Перезапуск службы**:

```sh
sudo systemctl restart my-service
```

5. **Проверка состояния службы**:

```sh
sudo systemctl status my-service
```

6. **Включение службы при загрузке системы**:

```sh
sudo systemctl enable my-service
```

7. **Отключение службы при загрузке системы**:

```sh
sudo systemctl disable my-service
```

# Запуск по таймеру

Файлы .timer в systemd используются для создания таймеров, которые позволяют запускать определенные службы, юниты или выполнять другие действия по расписанию. Это очень удобно для автоматизации задач в Linux системах. Вот как обычно устроен файл .timer:

1. **Unit** - это секция, где определяется название таймера и его описание. Например:

```
[Unit]
Description=My Timer
```

2. **Timer** - в этой секции определяется расписание, когда таймер должен запускать связанный с ним юнит (указанный в файле таймера, параметр `Unit`). Расписание может быть абсолютным (определенное время) или относительным (например, "каждые 10 минут"). Вот пример:

```
[Timer]
OnCalendar=*-*-* 00:00:00
```

В данном примере таймер запустит связанный юнит каждый день в полночь.

3. **Install** - определяет, когда таймер должен быть активирован. Например:

```
[Install]
WantedBy=timers.target
```

Это примерное описание содержимого файла .timer в systemd. Когда таймер активен, он запускает связанный с ним юнит в соответствии с определенным расписанием. Это может быть полезно для регулярного выполнения задач, например, резервного копирования данных, обновления базы данных и т. д.

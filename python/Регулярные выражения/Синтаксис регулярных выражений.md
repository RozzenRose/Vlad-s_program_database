#Python #регулярные_выражения #поиск_заданного_выражения


|Метасимвол|Диапазон|Описание|
|---|---|---|
|`\d`|`[0-9]`|любая цифра|
|`\D`|`[^0-9]`|любой нецифровой символ|
|`\w`|`[0-9a-zA-Zа-яА-ЯёЁ_]`|любой алфавитно-цифровой символ и символ `_`|
|`\W`|`[^0-9a-zA-Zа-яА-ЯёЁ_]`|любой символ, отличный от алфавитно-цифрового и `_`|
|`\s`|`[ \f\n\r\t\v]`|любой пробельный символ|
|`\S`|`[^ \f\n\r\t\v]`|любой непробельный символ|

| Шаблон  | Описание                                 |
| ------- | ---------------------------------------- |
| `{n}`   | ровно `n` повторений                     |
| `{m,n}` | от `m` до `n` повторений включительно    |
| `{m,}`  | не менее `m` повторений                  |
| `{,n}`  | не более `n` повторений                  |
| `?`     | ноль или одно вхождение, синоним `{0,1}` |
| `*`     | ноль или более, синоним `{0,}`           |
| `+`     | одно или более, синоним `{1,}`           |

| Жадный  | Ленивый  |
| ------- | -------- |
| `*`     | `*?`     |
| `+`     | `+?`     |
| `?`     | `??`     |
| `{m,n}` | `{m,n}?` |
| `{,n}`  | `{,n}?`  |
| `{m,}`  | `{m,}?`  |
Для создания регулярных выражений необходимо использовать специальный синтаксис. Любая строка текста сама по себе является регулярным выражением. Регулярные выражения могут содержать простой или даже состоять из него полностью

Например:
Регулярному выражению:
```
Rozzen
```
в тексте:
```
Hello, my name is Rozzen. Please visit my steam at https://steamcommunity.com/id/rozzenrose
```
слово `Rozzen`

Используемое здесь регулярное выражение - буквальный текст, и оно находит вхождение `Rozzen` в исходном тексте



### Поиск любого символа `.`
С помощью регулярных выражений можно искать не только известный заранее текст, но и текст в котором есть неизвестные символы. Чтобы найти соответствие некоторому шаблону, в регулярных выражениях используются специальные символы, которые называются **метасимволами**. Символ `точка` соответствует одному любому символу.

Регулярному выражению:
```
sales.
```
в тексте:
```
sales1.csv
orders3.csv
sales2.csv
sales3.csv
apac1.csv
europe2.csv
na1.csv
na2.csv
sa1.csv
```
соответствует (выделено жирным шрифтом):
```
sales1
sales2
sales3
```
Регулярное выражение `sales.`, позволяет найти все имена файлов, содержащие подстроку `sales`, за которой следует еще один произвольный символ. Ровно три файла из девяти соответствует такому шаблону

`точка` соответствует любому символу алфавита, включая саму точку

### Поиск символа точки `\.`
Точка имеет специальное значение в регулярных выражениях. Если в регулярном выражении нужен сам символ точки `.` , то ее необходимо экранировать. Для этого необходимо предварить точку символом обратного слэша `\`

Регулярному выражению:
```no-highlight
.a.\.csv
```
в тексте:
```no-highlight
sales1.csv
orders3.csv
sales2.csv
sales3.csv
apac1.csv
europe2.csv
na1.csv
na2.csv
sa1.csv
```
соответствует:
```
na1.csv
na2.csv
sa1.csv
```

### Поиск цифр `\d`
Для поиска любого символа цифры используется специальный метасимвол `\d`

Регулярному выражению:
```no-highlight
..\d
```
в тексте:
```no-highlight
sales.csv
sales1.csv
orders3.csv
sales2.csv
sales3.csv
apac1.csv
europe2.csv
na1.csv
na2.csv
sa1.csv
```
соответствует:
```
es1
rs3
es2
es3
ac1
pe2
na1
na2
sa1
```
Для нецифровых символов используется метасимвол `\D`

### Поиск пробельных символов `\s`
Для поиска пробельного символа используется метасимвол `\s`

А для поиска любого непробельного символа используется метасимвол `\S`


### Поиск алфавитно-цифровых символов `\w`
Есть еще один часто используемый набор букв и цифр и символ подчеркивания.
Для поиска таких символов используется метасимвол `\w`

Регулярному выражению:
```
\w\w\w\w
```
в тексте:
```
_xy_
1234
geek
-xy-
Code
a1b2
```
соответствует (выделено жирным шрифтом):
```
_xy_
1234
geek
Code
a1b2
```

Для поиска символов не являющихся буквой, цифрой и подчеркиванием используется метасимвол `\W`

### Соответствие одному из нескольких символов `[]`
Набор символов определяется с помощью метасимволов `[]`. Будет выполнен поиск любого элемента внутри скобок.

Регулярному выражению:
```no-highlight
[ns]a.\.csv
```
в тексте:
```no-highlight
sales1.csv
orders3.csv
sales2.csv
sales3.csv
apac1.csv
europe2.csv
sam.csv
na1.csv
na2.csv
sa1.csv
ca1.csv
```
соответствует:
```
sam.csv
na1.csv
na2.csv
sa1.csv
```
Используемое здесь регулярное выражение начинается с `[ns]`, которое соответствует либо символу `n`, либо символу `s`. Символы `[]` не соответствуют никаким символам, они определяют набор

Подвыражения и экранирование там не работает, только символы и метасимволы, такие, как `\w`, `\d` и т.д.

### Соответствие с чем угодно, кроме `^`
Наборы символов обычно используются для того, чтобы определить список символов, любой из которых может соответствовать одному символу. Но иногда проще указать список символов, ни с одним из которых не должен совпадать данный символ. Другими словами, нужно указать соответствие с чем угодно, кроме того, что указано в наборе символов

Вместо того, чтобы перечислять каждый символ, можно инвертировать наборы символов, используя метасимвол `^`

Регулярному выражению:
```
[ns]a[^0-9]\.csv
```
в тексте:
```
sales1.csv
orders3.csv
sales2.csv
sales3.csv
apac1.csv
europe2.csv
sam.csv
na1.csv
na2.csv
sa1.csv
ca1.csv
```
соответствует:
```
sam.csv
```

Диапазон `[0-9]` соответствует всем цифрам. Выражение `[^0-9]` соответствует чему угодно, кроме цифр указанного диапазона. Именно поэтому приведенное регулярное выражение нашло `sam.csv`, но не нашло `na1.csv, na2.scv` и `sa1.csv`

Метасимвол `^` отрицает все символы или диапазоны в наборе, а не только символ или диапазон, которому он предшествует


### Соответствие одному из нескольких регулярных выражений `|`
Символ вертикальной черты `|` выполняет роль логического оператора `или` в регулярных выражениях и служит для задания набора альтернатив. Мы можем использовать его всегда, когда хотим найти соответствие одному из нескольких альтернативных выражений

Регулярному выражению:
```
sales[0-9]|[ns]a[0-9]\.csv
```
в тексте:
```
sales1.csv
orders3.csv
sales2.csv
sales3.csv
apac1.csv
europe2.csv
sam.csv
na1.csv
na2.csv
sa1.csv
ca1.csv
```
соответствует:
```
sales1
sales2
sales3
na1.csv
na2.csv
sa1.csv
```


### Соответствие с одним или несколькими символами `+`
Символ `+` устанавливает соответствие с одним или более символами. Таким образом, если регулярное выражение `a` соответствует одному символу `a`, то регулярное выражение `a+` соответствует одному или несколькими символами `a`. Точно так же, учитывая, что регулярное выражение `[0-9]` соответствует любой цифре, регулярное выражение `[0-9]+` соответствует последовательности, состоящей из одной или нескольких цифр

Регулярному выражению:
```
a+[0-9]+
```
 в тексте:
```
acedia1.csv
acediaaa1.csv
acediaa12345.csv
baham98.csv
sea777.json
shaaaaa123456789.json
spa.doc
naaa1.csv
na2.csv
sab1.csv
cattt1.csv
```
соответствует:
```
a1
aaa1
aa12345
a777
aaaaa123456789
aaa1
a2
```


### Поиск нуля и большего количества символов `*`
Символ `*` устанавливает соответствие с одним или более символами. С отсутствующими символами соответствие установлено не будет. Иногда возникает задача, в которой нужно установить соответствие с необязательными символами, то есть с такими символами, которые могут отсутствовать вообще

Для того чтобы найти соответствие с необязательными символами в регулярных выражениях используется метасимвол `*`. Метасимвол `*`используется в точности так, как `+`, он записывается сразу после символа или набора и соответствует нулю или большему количеству вхождений

Регулярному выражению:
```
aaa[0-9]*
```
 в тексте:
```
acedia1.csv
acediaaa1.csv
acediaa12345.csv
baham98.csv
sea777.json
shaaaaa123456789.json
spa.doc
naaa123.csv
na2.csv
sab1.csv
aaa.csv
```
соответствует:
```
aaa1
aaa
aaa123
aaa
```


### Соответствие с нулем вхождений или с вхождением одного символа `?`

Метасимвол `?` позволяет установить соответствие с необязательными символами. В отличие от символа `*`, символ `?` соответствует только отсутствию вхождений или одному вхождению

Регулярному выражению:
```
https?://[\w./]+
```
в тексте:
```
URL http://stepik.org/ уже не безопасен. Для безопасного подключения вместо него используйте https://stepik.org/
```
соответствует:
```
http://stepik.org/
https://stepik.org/
```


### Использование интервалов `+` `*` `?`
Метасимволы `+`, `*` и `?` помогают решить много проблем с регулярными выражениями, но иногда этих символов недостаточно. Учтем, что:
- символы `+` и `*` соответствуют неограниченному числу символов. Они не дают возможности установить максимальное количество символов
- минимальное количество вхождений, указываемое с помощью символов `+`, `*` и `?`, равно нулю или единице. Эти метасимволы не позволяют установить минимальное количество совпадений явно
- нет способа определить точно количество желаемых совпадений

Чтобы решить эти проблемы и обеспечить большую свободу управления повторением совпадений, в регулярных выражениях имеется возможность использования интервалов. Интервалы определяются между символами `{` и `}`


### Указание точного количества совпадений `{}`
Чтобы определить точное количество совпадений, число совпадений указывают между фигурными скобками `{` и `}`. Поэтому `{3}` означает поиск соответствий с тремя экземплярами предыдущего символа или набора



### Установление соответствия в случае интервала-диапазона `{}`
Чтобы определить диапазон количества вхождений (от минимального к максимальному), также используются интервалы. Диапазоны определяются, например, так: `{2, 4}`. Этот диапазон задает 2 в качестве минимального значения для количества вхождений и 4 - в качестве максимального значения для количества вхождений

Регулярному выражению:
```
\d{1,2}[-/]\d{1,2}[-/]\d{2,4}
```
в тексте:
```
4/8/07
04-08-2007
3/3/3
02-02-09
```
соответствует:
```
4/8/07
04-08-2007
02-02-09
```
Шаблону `\d{1, 2}` соответствует одна или две цифры (такая проверка используется для дня и месяца). Шаблону `\d{2,4}` соответствует две, три или четыре цифры. Шаблону `[-/]` соответствует `-` или `/` в качестве разделителя даты. Указанное регулярное выражение нашло три даты, но не нашло `3/3/3`, потому что для года последовательность цифр слишком короткая


### Установление соответствия в случае интервала типа `не менее` и `не более` `{}`
Интервалы также можно использовать для того, чтобы определить минимальное количество совпадений, не указывая при этом максимального. Синтаксис для этого типа интервала подобен синтаксису для диапазонов, но в нем опущен максимум. Например, шаблон `{3,}` означает совпадение не менее чем с 3 вхождениями

Приведем пример регулярного выражения, которое используется, чтобы определить местонахождение всех заказов, оцененных в 100 или больше долларов

Регулярному выражению:
```
\d+: \$\d{3,}\.\d{2}
```
в тексте:
```
998: $121.80
999: $11.65
1000: $100.99
1001: $1290.69
1002: $1.46
1003: $416.90
1004: $25.00
```
сооветствует:
```
998: $121.80
1000: $100.99
1001: $1290.69
1003: $416.90
```

Аналогично интервалам типа `не менее` мы можем работать с интервалами типа `не более`. Синтаксис для этого типа интервала подобен синтаксису для диапазонов, но в нем опущен минимум. Например, шаблон `{,3}` означает совпадение не более чем с 3 вхождениями (ноль, один, два или три)


### Жадность и ленивость
Рассмотрим регулярное выражение, которое находит любой текст внутри тегов `<B></B>`
```
<B>.*</B>
```
Такому выражению в тексте:
```
Подписку нельзя оформить клиентам, живущим в <B>России</B>, а также <B>Беоапуси</B>. Приносим свои извенения.
```
соответствует:
```
<B>России</B>, а также <B>Беоапуси</B>
```

Метасимволы `*` и `+` являются `жадными`, то есть они ищут наибольшее возможное соответствие, а не наименьшее. Из-за этого кажется, что соответствие начинается не с начала, а с конца текста и продолжается назад, пока не будет найдено следующее соответствие

Если нам не нужно жадное поведение, то необходимо использовать `ленивые` аналоги этих метасимволов

Ленивые метасимволы определяются путем добавления в конец `?` к используемому метасимволу, причем для каждого метасимвола имеется ленивый эквивалент

| Жадный  | Ленивый  |
| ------- | -------- |
| `*`     | `*?`     |
| `+`     | `+?`     |
| `?`     | `??`     |
| `{m,n}` | `{m,n}?` |
| `{,n}`  | `{,n}?`  |
| `{m,}`  | `{m,}?`  |
Регулярному выражению:
```
<B>.*?</B>
```
в тексте:
```
Подписку нельзя оформить клиентам, живущим в <B>России</B>, а также <B>Беларуси</B>. Приносим свои извинения.
```
соответствует:
```
<B>России</B>
<B>Беларуси</B>
```
Используя ленивый метасимвол `*?`, мы добились правильного результата


### Границы слова `\b` `\B`
Символ `\b` указывает границу слова. Таким образом, `\b` соответствует началу и концу слова

Регулярному выражению:
```
\bcat\b
```
в тексте:
```
The cat scattered his food all over the room.
```
соответствует:
```
cat
```

Перед словом `cat` и после него есть пробел, и слово вместе с пробелами соответствует регулярному выражению `\bcat\b`, так как пробел - один из символов, которые обычно отделяют слова. Вхождение `cat` в слово `scattered` не соответствует этому регулярному выражению, потому что в слове `scattered` ему предшествует символ `s`, а после него идет символ `t`, ни один из которых не соответствует `\b`

Важно помнить, что для того чтобы найти слово целиком, символ `\b` должен использоваться и перед, и после текста, с которым будет установлено соответствие. Выражению `\bcap` будет соответствовать слово `capitalize`

При использовании `\B` все начинает работать наоборот, выражению соответствуют комбинации букв, но не слова.

Выражению `\Bas\B` соответствует последовательность букв `as`, которая при этом не является словом


### Определение границ строк `^` `$`
Границы слов позволяют указать местонахождение совпадений относительно позиций в слове. Границы строк выполняют подобную функцию, но используются для нахождения соответствий с шаблоном регулярного выражения в начале или конце всей строки

Метасимволы для границ строк - крышка `^`(начало строки) и доллар `$`(конец строки)

Регулярному выражению:
```
^[Hh]ello
```
в тексте:
```
Hello, Timur. I haven't seen you for ages. I want to be his favorite hello and his hardest goodbye.
```
соответствует: `Hello`

Аналогичным образом используется символ `$`. Этот символ помогает проверить, что строка текста оканчивается определенным образом

Регулярному выражению:
```
[Gg]oodbye$
```
в тексте:
```
Goodbye my dear friend, goodbye! I miss you so much. Goodbye
```
соответствует: `Goodbye`

### Подвыражения `()`
Подвыражения позволяют объединять символы в последовательности:

Регулярному выражению:
```
Rozzen{2,}
```
в тексте:
```
Rozzen the best GT3 pilot s the world! RozzenRozzenRozzen!
```
не будет соответствовать ничего. Потому что два или более раза должна встречаться буква `n` в конце слова `Rozzen` , что то типо `Rozzennnnn`

Но вот выраженью:
```
(Rozzen){2,}
```
будет соответствовать `RozzenRozzenRozzen`

### Вложенные подвыражения
Подвыражения могут быть вложенными. Одни подвыражения могут быть вложены в другие подвыражения, которые, в свою очередь, вложены в третьи подвыражения и т.д.

Попробуем описать IP адрес при помощи регулярного выражения:
```
(\d{1,3}\.){3}\d{1,3}
```
Вроде да, но так то не совсем точно, все цифры в IP адресах ограниченны цифрой `255`(максимальный IP `255.255.255.255`), Но регулярные выражения вообще не про цифры и не про их сравнения, они про последовательность символов. Можно вывести правила для символов при соблюдении, которых у вас не получится числовое значение больше `255`:
- любое однозначное или двузначное число
- любое трехзначное число, начинающееся с 1
- любое трехзначное число, начинающееся с 2, если вторая цифра в диапазоне от 0 до 4
- любое трехзначное число, начинающееся с 25, если третья цифра находится в диапазоне от 0 до 5

Ну и теперь достаточно просто выразить эти правила в виде регулярного выражения:
```
(((\d{1,2})|(1\d{2})|(2[0-4]\d)|(25[0-5]))\.){3}((2[0-4]\d)|(25[0-5])|(1\d{2})|(\d{1,2}))
```


### Ссылки назад
Предположим, что в тексте нужно найти все подряд повторяющиеся слова, то есть опечатки, где то же самое слово было по ошибку напечатано дважды. Очевидно, что при поиске второго вхождения слова должно быть известно предыдущее слово. `Ссылки назад` позволяют в регулярном выражении обратиться к предыдущим совпадениям

Регулярному выражению:
```no-highlight
(\b\w+\b)[ ]+\1
```
в тексте:
```no-highlight
Это текст, в котором котором несколько слов    слов повторяются, хотя они и не   не должны повторяться повторяться.
```
соответствует: 
`котором котором`, `слов    слов`, `не   не`, `повторяться повторяться`

Выражение `\w+` соответствует одному или нескольким алфавитно-цифровым символам, а выражение `[ ]+` соответствует любым пробелам в конце. Выражение `\w` заключено в круглые скобки, потому является подвыражением. Это подвыражение используется не для того, чтобы найти повторные слова, а для того, чтобы сгруппировать символы в одно выражение, пометить его и идентифицировать для использования в дальнейшем. Заключительная часть этого регулярного выражения `\1` это и есть ссылка назад на подвыражение, и всякий раз, когда подвыражению `(\w+)` соответствует слово, тому же слову соответствует и `\1`.
Например, когда `(\w+)` соответствует слову `котором`, `\1` также соответствует слову `котором`
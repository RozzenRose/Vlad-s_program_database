#FastAPI 

![[Pasted image 20250327181414.png]]
Передача состояния представления (**REST**) содержит правила, процессы и инструменты, которые обеспечивают взаимодействие между микросервисами. Это службы методов, которые идентифицируются и выполняются через **URL**-адреса конечных точек. В настоящее время сосредоточение внимания на методах `API` перед созданием всего приложения является одной из самых популярных и эффективных стратегий проектирования микросервисов. Этот подход, называемый разработкой микросервисов с упором на **API**, сначала фокусируется на потребностях клиента, а затем определяет, какие методы обслуживания **API** нам необходимо реализовать для удовлетворения этих требований клиента.

Мы начнем с самого простого приложения, в котором мы сможем получать, публиковать, изменять и удалять записи через  **API**. Пока мы рассмотрим инициализацию нашего приложения, а именно код:
```python
from fastapi import FastAPI

app = FastAPI()
```

**FastAPI** использует `app` как ссылку на экземпляр `FastAPI`. Все определения маршрутов и другой функциональности добавляются к этому экземпляру. Декораторы, начинающиеся с `@app`, являются удобным способом добавить методы, например `@app.get` или `@app.post`. Таким образом поддерживаются методы `GET`, `POST`, `PUT`, `DELETE`, а также менее используемые `OPTIONS`, `HEAD`, `PATCH`, `TRACE`.

Также можно создать несколько методов на одном маршруте `@app.get('/')` для одной функции и `@app.post('/')` для другой.

---
Попробуем написать не сложный **CRUD** проект
![[Pasted image 20250327175327.png]]
Первым делом напишем макет нашего проекта. Мы добавим функцию для получения всех данных, получения данных по идентификатору, добавления данных, удаления данных по идентификатору, удаления всех данных и функцию изменения данных.

Итак, каркас нашего приложения будет выглядеть вот так:
```python
from fastapi import FastAPI

app = FastAPI()

messages_db = {0: "First post in FastAPI"}

@app.get("/")
async def get_all_messages() -> dict:
    pass


@app.get("/message/{message_id}")
async def get_message(message_id: int) -> str:
    pass


@app.post("/message")
async def create_message(message: str) -> str:
    pass


@app.put("/message/{message_id}")
async def update_message(message_id: int, message: str) -> str:
    pass


@app.delete("/message/{message_id}")
async def delete_message(message_id: int) -> str:
    pass


@app.delete("/")
async def kill_message_all() -> str:
    pass
```
Разберем код подробнее, первым делом мы добавили переменную `message_db`, которая содержит в себе словарь. В котором ключом словаря является `id` записи. а значением сам текст записи. На данный момент этот словарь будет выполнять функцию базы данных.

**Далее мы объявляем следующие функции:**
- `get_all_messages()` Функция ничего не принимает и обернута в декоратор `GET` запроса по корневому адресу приложения. Она будет выводить все записи из словаря `messages_db`
- `get_message()` Функция принимает `message_id` записи из параметра пути и обернута в декоратор `GET` запроса. При запросе по адресу `/message/{id}` будет выводить запись из словаря `messages_db` с принятым `message_id`.
-  `create_message()`  Функция обернута в декоратор `POST` запроса и принимает текст (переменная `message`) из запроса. Она будет добавлять новую запись при `POST` запросе по пути `/message`
- `update_message()` Функция принимает `message_id` записи из параметра пути и обернута в декоратор `PUT` запроса. Она будет изменять запись, получая `message_id` записи из параметра пути и текст(переменная `message`) из запроса.
- `delete_message()` Функция принимает `message_id` записи из параметра пути и обернута в декоратор `DELETE` запроса. Она будет удалять запись из словаря `messages_db` с принятым `message_id`.
- `kill_message_all()`  Функция ничего не принимает, и обернута в декоратор `DELETE` запроса. При запросе к ней, будет полностью очищаться наш словарь `messages_db`.
#### [[GET - запросы]]
#### [[POST - запросы]]
#### [[PUT - запросы]]
#### [[DELETE - запросы]]
#### [[Валидация через Pydantic]]
#### [[Обработка ошибок]]
#### [[Конечный вариант кода]]
#### [[Использование шаблонов]]

#модуль #Сеlery

**Celery** - это самый популярный инструмент для асинхронной обработки задач. Он позволяет выполнять задачи в фоновом режиме и гибко настраивать параметры для каждой задачи. Кроме того, Celery предоставляет возможности для планирования, работы с разными очередями и мониторинга выполнения задач.

В целом это неблокирующая очередь задач, работающая в распределенной системе. Он может управлять асинхронными фоновыми процессами, которые огромные и требуют большой нагрузки на процессор. Это сторонний инструмент, поэтому сначала нам нужно установить его:
```Power Shell
pip install Calery
```
Он планирует и выполняет задачи одновременно на одном сервере или в распределенной среде. Но для отправки и получения сообщений требуется транспорт сообщений в строках, словарях, списках, наборах, растровых изображениях и типах потоков.
![[Pasted image 20250424131210.png]]
- **Broker (Брокер):** Сервер, который хранит задачи в очереди (queue). Celery поддерживает несколько брокерских систем, таких как RabbitMQ, Redis, Amazon SQS и другие. Брокер — сердце системы, он обеспечивает надежное хранение и доставку задач.
- **Worker (Рабочий):** Процесс (или процессы), которые извлекают задачи из очереди и выполняют их. Можно запускать несколько рабочих процессов для обработки задач параллельно. Рабочие могут быть размещены на одном сервере или распределены между несколькими серверами для масштабирования.
- **Task (Задача):** Функция Python, которая должна быть выполнена в фоновом режиме. Задачи определяются с помощью декоратора  `@app.task`.

В этом разделе используем `Redis` в качестве брокера сообщений. Однако вы можете использовать `RebbitMQ` в качестве брокера сообщений.

### Зачем использовать Celery?
**Celery** используется для решения проблем, связанных с выполнением длительных или ресурсоемких задач в веб-приложениях, не блокируя при этом основной поток выполнения и обеспечивая высокую доступность и масштабируемость. Вот несколько ключевых причин, почему разработчики выбирают **Celery**:

**1. Улучшение производительности и отзывчивости приложения:**
- **Неблокирующие операции:** Длительные операции, такие как обработка изображений, отправка электронной почты, выполнение сложных вычислений, не блокируют основной поток приложения. Пользователь получает быстрый ответ, а задача выполняется в фоновом режиме.
- **Повышение скорости отклика:** Приложение остается быстрым и отзывчивым, даже при обработке большого количества задач.

**2. Обработка асинхронных задач:**
- **Немедленный возврат:** Приложение может немедленно возвращать ответ пользователю, даже если обработка данных требует времени.
- **Улучшение масштабируемости:** Обработка задач в фоновом режиме позволяет легче масштабировать приложение для обработки большего количества запросов.

**3. Управление очередями задач:**
- **Гарантия доставки:** Celery обеспечивает надежное хранение и доставку задач, даже при сбоях серверов или рабочих процессов.
- **Распределение задач:** Задачи можно распределять между несколькими рабочими процессами для параллельной обработки.
- **Приоритезация задач:** Celery позволяет настраивать приоритеты задач, что позволяет обрабатывать более важные задачи сначала.

**4. Мониторинг и управление задачами:**
- **Отслеживание состояния задач:** Celery предоставляет инструменты для мониторинга состояния задач (в процессе выполнения, выполнена, не удалось и др.).
- **Перезапуск задач:** Неудачные задачи можно легко перезапустить.
- **Управление очередями:** Можно настраивать очереди задач и распределять задачи между ними в зависимости от типа задачи или приоритета.

**Примеры задач, для которых хорошо подходит Celery:**
- **Отправка электронной почты:** Отправка большого количества писем не должна блокировать веб-сервер.
- **Обработка изображений:** Ресайз, обрезка, добавление водяных знаков и другие операции с изображениями.
- **Выполнение сложных вычислений:** Вычисления, которые требуют много времени или ресурсов.
- **Генерация отчетов:** Генерация отчетов в фоновом режиме не мешает работе основного приложения.
- **Импорт данных:** Импорт большого количества данных из внешних источников.
- **Обработка платежей:** Обработка платежей в фоновом режиме позволяет быстро возвращать ответ пользователю.

В итоге, **Celery** позволяет построить масштабируемое и отзывчивое приложение, эффективно обрабатывающее задачи в фоновом режиме без потерь в производительности основного приложения. Это особенно ценно для приложения с высокой нагрузкой и требованиями к производительности. 

**Celery** использует архитектуру **производитель-потребитель** (**producer-cundumer**) для обработки задач. Два основных компонента этой архитектуры - это брокер (**broker**) и обработчики (**workers**)
### [[Брокеры]]

**Обработчики** - это процессы, которые извлекают задачи из очередей брокера и выполняют их.

Приложение отправляет задачи в брокер. Обработчики подключаются к брокеру и извлекают задачи из очередей. После выполнения задачи рабочий может отправить результат в брокер или систему хранения результатов.

В целом, брокер и рабочие являются ключевыми компонентами **Celery**, которые обеспечивают надежную и масштабную обработку задач в фоновом режиме. Правильный выбор брокера и оптимальная настройка обработчиков - важные факторы для эффективного использования **Celery**.
### [[Простые примеры]]
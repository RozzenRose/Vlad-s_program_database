#FastAPI #Pydantic #SQLAlchemy 

![[Pasted image 20250328162623.png]]
Pydantic - это мощная  Python-библиотека, предназначенная для создания и валидации данных. Она основана на сильной типизации и удобных инструментах, что значительно упрощает работу с данными в приложениях, особенно при работе с API.
#### Ключевые особенности Pydantic:
- **Валидация данных:** Pydantic предоставляет широкий спектр механизмов для валидации данных. Это включает проверку типов, диапазонов, форматов (например, e-mail, URL), уникальности и прочие сложные правила. Это значительно уменьшает риск ошибок и уязвимостей, связанных с некорректными данными от пользователей или из внешних источников.
- **Быстрое создание классов данных:** Pydantic автоматически генерирует методы для доступа к данным и методы для их валидации. Это значительно упрощает создание классов для представления и обработки данных, поскольку вам не нужно писать код для валидации и доступа к полям вручную.
- **Описание данных с помощью типов Python:** Pydantic использует стандартные типы Python (например, `int`, `str`, `float`, `bool`) и создает классы данных, которые соответствуют этим типам, что обеспечивает высокую читаемость и поддерживаемость кода. Это повышает прозрачность и предсказуемость поведения.
- **Удобная генерация документация:** Pydantic может автоматически генерировать документацию для классов, описывая все поля, их типы и валидаторы. Это особенно полезно при работе с API, потому что оно автоматически создает документацию по форматам обмена данными, с чего начинается работа разработчика.
- **Поддержка произвольных валидаторов:** Pydantic позволяет добавлять своих собственных валидаторов для проверки значений полей.  Это дает вам полный контроль над правилами валидации и позволяет соответствовать специфическим требованиям вашей системы.
- **Поддержка JSON:** Pydantic легко работает с форматом JSON. Он может сериализовать и десериализовать данные в формат JSON, значительно упрощая обмен между разными системами.
- **Необходимость явных описаний (типизации)**: Поскольку Pydantic основано на типизации, описание всех полей в классе данных обязательно.
### Модели
Модели создают путем определения подкласса `BaseModel` **Pydantic**. Она выглядит следующим образом:
```python
from pydantic import BaseModel

class Message(BaseModel):
    id: int
    text: str
```
Данная модуль `Message` состоит из двух полей:
- `id`, которое является целым числом,
- `text`, которое является строкой.

В результате данная модель будет представлена следующим образом:
```json
{
	"id": 0,
	"text": "string"
}
```
Мы также, как и в валидации параметров можем устанавливать несколько типов для поля, и также делать поле не обязательным и устанавливать значение по умолчанию:
```python
from pydantic import BaseModel

class Message(BaseModel):
    id: int
    description: str | None = None
    text: str = "Simple text"
```
Так же мы буквально можем объявить поле необязательным через `Optional[]`:
```python
for pydantic import BaseModel

class Message(BaseModel):
	id: int
	desctiption: Oprionl[str] = None
	text: str = "Simple text"
```
Поведение полей Pydantic можно настроить с помощью класса `Field()`. Для числовых полей вы можете применить критерии проверки `gt`, `ge`, `lt`, `le`. Чтобы ограничить длину строки, существуют свойства `min_length` и `max_length`: 
- **Общие метаданные**:
	- `title`: описание параметра, отображаемое в документации.
	- `description`: более подробное описание параметра.
	- `example`: пример значения параметра.
	- `include_in_schema`: параметр позволяет исключить исключить операцию пути из сгенерированной схемы **OpenAPI**
-  **Специфичные правила валидации**:
	- `min_length`: минимальная длина строки для параметра.
	- `max_length`: максимальная длина строки для параметра.
	- `pattern`: устанавливает регулярное выражение, которому должно соответствовать значение параметра
	- `lt`: значение должно быть меньше указанного
	- `le`: значение должно быть меньше или равно указанному
	- `gt`: значение должно быть больше указанного
	- `ge`: значение должно быть больше или равно указанному

```python
from pydantic import BaseModel, Field


class Message(BaseModel):
    id: int
    description: str | None = Field(default=None, description="The description of the message", max_length=300)
    text: str = "Simple text"
```
А использование `...` сделает это поле обязательным:
```python
from pydantic import BaseModel, Field


class Message(BaseModel):
    id: int
    description: str = Field(..., description="The description of the message", max_length=300)
    text: str = "Simple text"
```
Если мы работаем с полями даты, и хотим заполнять текущую дату и время автоматически, то можем использовать следующий код:
```python
created: datetime = Field(default_factory=datetime.now)
```
В дополнение к стандартным типам данных Python, библиотека Pydantic определяет свои собственные типы:
- `HttpUrl`: Это поле, по сути, является строкой со встроенной проверкой для URL. Тип HttpUrl принимает как HTTP, так и HTTPS схемы. Он требует указания TLD (домена верхнего уровня) и хоста, максимальная длина 2083 символа.
- `AnyUrl` позволяет использовать любую схему (TLD не требуется, но хост обязателен).
- `FileUrl` предназначено для хранения URL-адреса файла и не требует указания хоста.
- `EmailStr`: Это такая же строка, но которая должна быть действительным адресом электронной почты. Для проверки правильности представления электронной почты в виде строки требует установки модуля `email-validator`.
- `SecretStr`: Этот тип данных используется в основном для хранения паролей или любой другой конфиденциальной информации, которая не должна появляться в логах или другом отслеживании. При преобразовании в JSON он будет отформатирован как '`**********`'.
### Вложенные модели
Модели Pydantic также могут быть вложенными, например, следующие:
```python
from pydantic import BaseModel


class Item(BaseModel):
    description: str | None = None
    text: str = "Simple text"


class Message(BaseModel):
    id: int
    item: Item
```
В результате данные модели будут представлены следующим образом:
```json
{
  "id": 0,
  "item": {
    "description": "string",
    "text": "Simple text"
  }
}
```
#OOP #ООП #Python #магический_метод #атрибуты #setattr 


Метод `__setattr__()` вызывается при установке атрибута или при изменении его значения. Данный метод может быть полезен в том случае, если перед установкой атрибута мы хотим как-либо модифицировать его имя или значение, например, предварить его имя символом нижнего подчеркивания, чтобы сделать атрибут защищенным
```python
class Cat:
    def __init__(self, name, breed):
        self.name = name
        self.breed = breed
    
    def __setattr__(self, attr, value):
        attr = '_' + attr
        self.__dict__[attr] = value


cat = Cat('Никся', 'Девон рекс')

print(cat.__dict__)
```
```
{'_name': 'Никся', '_breed': 'Девон рекс'}
```
Важно заметить, что установка атрибута или изменение его значения внутри метода `__setattr__()` происходит напрямую через словарь атрибутов `__dict__`. Если попытаться сделать это через точечную нотацию, то, во-первых, метод `__setattr__()` будет рекурсивно вызывать сам себя, а во-вторых, будет устанавливать атрибут с фиксированным именем
```python
class Cat:
    def __init__(self, name, breed):
        self.name = name
        self.breed = breed

    def __setattr__(self, attr, value):
        print(f'Устанавливаю атрибуту {attr} значение {value}')
        attr = '_' + attr
        self.attr = value


cat = Cat('Никся', 'Девон рекс')

print(cat.__dict__)
```
```
Устанавливаю атрибуту name значение Никся
Устанавливаю атрибуту attr значение Никся
Устанавливаю атрибуту attr значение Никся
Устанавливаю атрибуту attr значение Никся
...
```
До тех пор, пока не будет достигнуто максимальное значение глубины рекурсии, а затем возбуждает исключение:
```
RecursionError: maximum recursion depth exceeded while calling a Python object
```
Обратите внимание, что второй и последующий вызов устанавливают значение атрибуту `attr`, а не `name`, так как именно оно указанно после точки

Вместо обращения к словарю атрибутов `__dict__`, метод `__setattr__()` может использовать свою базовую реализацию из класса `object`
```python
class Cat:
    def __init__(self, name, breed):
        self.name = name
        self.breed = breed
    
    def __setattr__(self, attr, value):
        attr = '_' + attr
        object.__setattr__(self, attr, value)


cat = Cat('Никся', 'Девон рекс')

print(cat.__dict__)
```
```
{'_name': 'Никся', '_breed': 'Девон рекс'}
```
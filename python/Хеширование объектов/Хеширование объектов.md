#python #хеш #хеширование

### Хеширование
Хеш-функция - функция, осуществляющая преобразование набора входных данных __произвольного размера__ в последовательность __фиксированного размера__, выполняемое определенным алгоритмом. Преобразование, производимое хеш-функцией, называется __хешированием__, а результат преобразования называется **хешем, хеш-значением** или **хеш-кодом**
![[Pasted image 20240902162746.png]]
#### Принципы работы хеширования
Рассмотреть принципы работы хеширования можно на примере одной их популярных хеш-функций — SHA-1. Попробуем прогнать через нее строку`'beegeek'`, получим:
```
d7dd6be4b4a8a123f201ecbcacaf5883f1cec5e0
```
Если мы незначительно изменим входные данные, записав вместо строчной `b` заглавную `B`, то хеш-значение примет вид:
```
4f27087e433ab69ec25abfee3eb192980c0887eb
```
Несложно заметить, что небольшие изменения во входных данных приводят к большим изменениям в хеш-значениях. Такой эффект называется __лавинообразным эффектом__ и является одной из характеристик хорошей хеш-функции

Опробовать различные популярные хеш-функции, такие как `SHA-1` и `MD5`, можно [тут](https://ipcalc.co/util/sha1/)

В определении хеш-функци, упоминается, что она преобразует данные произвольного размера в данные фиксированного размера. Например, рассматриваемая хеш-функция `SHA-1` всегда возвращает строку из `40` цифр и/или строчных латинских символов, независимо от объема входных данных: это может быть как строки их `7` символов, так и из `7000`
##### Коллизия хеш-функции
__Коллизией хеш-функции__ называется ситуация, когда у двух __разных__ наборов входных данных __совпадают__ хеш-коды. Коллизии существуют для большинства хеш-функций, но для хороших хеш-функций частота их возникновения сведена к минимуму

В некоторых частных случаях, когда множество различных входных данных конечно, можно задать хеш-функцию, не имеющую коллизий. Однако для хеш-функций, принимающих на вход произвольное количество данных переменной длины и возвращающих хеш-значения постоянной длины, коллизии обязаны существовать, поскольку хотя бы для одного значения хеш-функции соответствующее ему множество входных данных будет бесконечно - и любые два набора данных из этого множества образую коллизию

##### Детерминированность
Одной из характеристик хеш-функции является __детерминированность__, то есть при одинаковых входных данных она возвращает одинаковый результат. Из этого следуют два следующих утверждения:
1. если мы имеем два равных набора данных, то хеш-значения этих наборов тоже будут равны
2. если мы имеем два набора данных, хеш-значения которых не равны, то и сами наборы тоже будут не равны

Важно понимать, что из равенства хеш-значений двух наборов данных мы не можем однозначно заключить, что эти наборы тоже равны, поскольку любая хеш-функция, работающая с произвольным количеством данных, может иметь коллизии



### Характеристики хорошей хеш-функции
- детерминированность
- равномерное распределение хеш-значений
- минимальное количество коллизий
- быстрое вычисление хеш-значений
### Области применения хеширования
Хеш-функции - незаменимый и повсеместно распространенный инструмент, используемый для выполнения целого ряда задач, в число которых можно отнести проверку целостности данных и безопасное хранения данных паролей в базах данных
##### Проверка целостности данных
Для проверок целостности данных зачастую используются простые хеш-функции. Например, один пользователь передает другому определенный набор данных, а затем хеш от него. Получатель информации, захешировав полученную информацию у себя и сравнив хеши, может удостовериться, что он получил именно те данные, которые были отправлены

Хеш-значение, используемое для проверки целостности данных при их передаче или хранении, называется __контрольной суммой__.

##### Работа с большими объемами информации
Хеш-функция может облегчить работу с большими объемами информации. Например, в текст, состоящий их нескольких миллионов различных строк нужно добавить еще одну, при условии, что ее еще нет. Чтобы не заниматься посимвольным сравнением каждой строки, можно предварительно вычислить хеш каждой из низ, и уже сделать сравнение по нему. Вся работа упрощается и ускоряется в разы

##### Хранение паролей
Одна из областей применения хеширования - хранение паролей. В целях безопасности онлайн-сервисы не хранят пароли в явном виде, они хранят их хеш-значения. Когда мы пытаемся выполнить вход в свою учетную запись и вводим пароль, происходит сравнение хеш-значения введенного пароля и хеш-значения фактического пароля, хранящегося в базе данных онлайн сервиса.

К примеру, если мы забудем пароль к какому-либо онлайн сервису, скорее всего, придется воспользоваться функцией восстановления пароля. В этом случае мы, впрочем, не получим свой старый пароль, поскольку онлайн сервис на самом деле сам его не знает. Он знает лишь его хеш-значение

Если вы, воспользовавшись функцией восстановления пароля, вдруг получили старый пароль в открытом виде, то можете быть уверены: используемый вами сервис не хеширует пользовательские пароли, что очень плохо

### Встроенная функция `hash()`
Встроенная функция `hash()` используется для вычисления хеш-значения объекта. Она принимает один аргумент:
- `object` - объект, хеш-значение которого требуется вычислить

Функция возвращает __целое число__, представляющее хеш-значение переданного объекта
```python
print(hash(1))                          # хеш-значение целого числа
print(hash(2.5))                        # хеш-значение вещественного числа
print(hash('bee'))                      # хеш-значение строки
print(hash((1, 2, 3)))                  # хеш-значение кортежа
```
```
1
1152921504606846978
7327928671037089808
529344067295497451
```
Для более сложных типов данных, например, `str`, встроенная функция `hash()` возвращает новое хеш-значение при каждом новом запуске программы
```python
print(hash('beegeek'))
print(hash('beegeek'))
print(hash('beegeek!'))
print(hash('beek'))
print(hash('geek'))
```
```
3750473969066821398
3750473969066821398
-5101520736652926912
6279574873516782143
-8122464414691433199
```
Обратите внимание на то, что первые два значения всегда будут равны между собой, поскольку данный код работает в рамках одного запуска программы. Если программу перезапустить, значения будут совершенно другими

Дело в том, что `Python` по умолчанию использует рандомизацию хешей для некоторых типов (например, `str`), чтобы сделать хеш-значения менее предсказуемыми. Это делает функцию `hash()` более безопасной.

Функция `hash()` может работать не только с числами и строками, но и с большинством встроенных типов данных
```python
print(hash(None))
print(hash(print))
print(hash(hash))
```
```
-9223363241050908545
4611694664844004019
8646416648793
```
Встроенная функция `hash()` не работает с экземплярами встроенных изменяемых типов данных, таких как `list`, `set` и `dict`. Такие объекты являются __нехешируемыми__.
```python
print(hash(['bee', 'geek']))
```
```
TypeError: unhashable type: 'list'
```
Встроенная функция `hash()` работает с экземплярами типа `tuple` только в том случае, если их элементами являются хешируемые объекты
```python
print(hash(('bee', 'geek', 1)))
```
```
8983813428229996918
```
```python
print(hash(('bee', 'geek', [1, 2, 3])))
```
```
TypeError: unhashable type: 'list'
```
### Примечания 

##### Примечание 1
Ни в коем случае нельзя сохранять хеш-значения, возвращаемые функцией `hash()`, в базу данных для дальнейшего использования. Во-первых, они могут быть различными при каждом новом запуске программы, во-вторых, алгоритм хеширования может поменять в новых версиях `Python`

##### Примечание 2
Переменная окружения - это переменная, значение которой присваивается извне. Как правило, ее устанавливают в командной строке перед тем. как обратиться к исполняемому файлу `Python`. После этого ОС позволяет программе `Python` получать доступ к такой переменной. Мы можем отключить рандомизацию для хешей, установив фиксированное начальное значение для переменной окружения `PYTHONHASHSEED`

##### Примечание 3
На 64-х разрядном компьютере встроенная функция `hash()` возвращает целочисленное значение из диапазона `[-2305843009213693950; 2305843009213693950]`.

##### Примечание 4
В Python равные числовые значения имеют равные хеш-значения, независимо от их типа.
```python
from decimal import Decimal
from fractions import Fraction

print(hash(17))
print(hash(17.0))
print(hash(Decimal(17)))
print(hash(complex(17, 0)))
print(hash(Fraction(17, 1)))
```
```
17
17
17
17
17
```
Подробнее почитать про хеширование чисел можно по [ссылке](https://docs.python.org/3/library/stdtypes.html#numeric-hash).

##### Примечание 5 
Хеш-значение пустой строки равно нулю.
```python
print(hash(''))
```
```
0
```

##### Примечание 6
Хеш-значение булевых констант `True` и `False` равны `1` и `0` соответственно.
```python
print(hash(True))
print(hash(False))
```
```
1
0
```

##### Примечание 7
Алгоритм и различные настройки встроенной функции `hash()` можно получить с помощью модуля `sys`.
```python
import sys

print(sys.hash_info)
```
```
sys.hash_info(width=64, modulus=2305843009213693951, inf=314159, nan=0, imag=1000003, algorithm='siphash24', hash_bits=64, seed_bits=128, cutoff=0)
```

### [[Сужение диапазона хеш-значений]]

### [[Создание собственной хеш-функции]]
Встроенная функция `hash()` не является [криптостойкой](https://ru.wikipedia.org/wiki/%D0%9A%D1%80%D0%B8%D0%BF%D1%82%D0%BE%D0%B3%D1%80%D0%B0%D1%84%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B0%D1%8F_%D1%85%D0%B5%D1%88-%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F). Криптостойкие хеш-функции доступны в модуле [hashlib](https://docs.python.org/3/library/hashlib.html).
### [[Хешируемость и неизменяемость]]
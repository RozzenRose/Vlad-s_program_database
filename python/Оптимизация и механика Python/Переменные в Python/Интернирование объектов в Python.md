#OC #Python #пременные #интернирование #механика


Как мы знаем, в Python целые числа (тип `int`) и строки (тип `str`) являются неизменяемыми. Это значит, что после того как строковые и целочисленные объекты были созданы, мы не можем изменить или обновить их. Даже если кажется, что строка изменяется, например, после использования метода, на самом деле создается новая строка, а исходная остается прежней.
```python
s1 = 'beegeek'

s2 = s1.lower()
s3 = s1.upper()

print(s1)
```
```python
beegeek
```

Учитывая неизменяемость строковых и целочисленных объектов, Python использует специальную оптимизацию, которая называется интернированием. Интернирование – это процесс хранения в памяти только одной копии объекта. Это означает, что, когда мы создаем две строки (два целых числа) с одинаковыми значениями, то вместо выделения памяти для них обоих, только одна строка (целое число) фактически фиксируется в памяти. Другая же просто указывает на то же самое место в памяти. Для реализации данной оптимизации Python использует специальную таблицу, которая называется пул интернирования. Эта таблица содержит одну уникальную ссылку на каждый объект строкового типа, либо целого числа.

### Интернирование целых чисел
Поскольку небольшие целые числа встречаются достаточно часто в нашем коде, Python интернирует их в диапазоне от −5 до 256.
```python
num1 = 100
num2 = 100

num3 = 1000
num4 = 1000

print(num1 is num2, num1 == num2)
print(num3 is num4, num3 == num4)
```
```
True True
False True
```
![[Pasted image 20240523122611.png]]
Важно отметить, что среда, в которой выполняется код, влияет на то, как работает интернирование. Поведение может отличаться при использовании различных IDE (PyCharm, Thonny и т.д.), так как все они имеют собственные уровни оптимизации. Все примеры в данном конспекте, а также в задачах, предполагают, что код выполняется в IDLE Python 3.10.

Стоит обратить внимание на то, что независимо от того, каким образом мы создаем целочисленный объект, если он находится в диапазоне от −5−5 до 256256, он будет интернирован.
```python
num1 = 100 
num2 = int(100)
num3 = int('100')
num4 = 1 + 2 + 97

print(id(num1))
print(id(num2))
print(id(num3))
print(id(num4))
```
```
1979656244560
1979656244560
1979656244560
1979656244560
```

### Интернирование строк
В Python 3.7 интернируются строки, содержащие не более 2020 символов и состоящие только из ASCII-букв, цифр и знаков подчёркивания. Данный набор символов был выбран потому, что он часто используется в нашем коде.
```python
s1 = 'beegeek'
s2 = 'beegeek'
s3 = 'bee' + 'geek'

print(id(s1))
print(id(s2))
print(id(s3))
```
```
2846528331184
2846528331184
2846528331184
```
![[Pasted image 20240523122926.png]]
```python
s1 = 'beegeek!'
s2 = 'beegeek!'

print(id(s1))
print(id(s2))
```
```
2846528331312
2846528331440
```
![[Pasted image 20240523122953.png]]
В этом примере использован восклицательный знак, поэтому строки не интернируются и представляют собой разные объекты.

Начиная с Python 3.8 длина интернируемых строк была увеличена до 4086 символов.
```python
s1 = 'b' * 4096
s2 = 'b' * 4096

s3 = 'b' * 5000
s4 = 'b' * 5000

print(s1 is s2)
print(s3 is s4)
```
```
True
False
```
![[Pasted image 20240523123212.png]]

### Функция sys.intern()
Как мы уже знаем, Python интернирует лишь строки, содержащие не более 40964096 символов и состоящие только из ASCII-букв, цифр и знаков подчёркивания. Однако функция `intern()` из модуля `sys` позволяет интернировать любую строку, например, содержащую 50005000 символов или состоящую из букв русского алфавита. Данная функция принимает в качестве аргумента строку, добавляет ее в пул интернирования (если ее там нет) и возвращает интернированную строку.
```python
s1 = 'степик!'
s2 = 'степик!'

print(s1 is s2)
```
```
False
```